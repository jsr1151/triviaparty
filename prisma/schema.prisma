generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  questions   Question[]
}

model JeopardyGame {
  id         String             @id @default(cuid())
  showNumber Int
  airDate    String
  season     Int?
  categories JeopardyCategory[]
  createdAt  DateTime           @default(now())
}

model JeopardyCategory {
  id       String        @id @default(cuid())
  gameId   String
  game     JeopardyGame  @relation(fields: [gameId], references: [id])
  name     String
  round    String
  position Int
  clues    JeopardyClue[]
}

model JeopardyClue {
  id          String           @id @default(cuid())
  categoryId  String
  category    JeopardyCategory @relation(fields: [categoryId], references: [id])
  question    String
  answer      String
  value       Int?
  dailyDouble Boolean          @default(false)
  airDate     String?
  createdAt   DateTime         @default(now())
}

model Question {
  id          String    @id @default(cuid())
  type        String
  categoryId  String?
  category    Category? @relation(fields: [categoryId], references: [id])
  difficulty  String    @default("medium")
  question    String
  explanation String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  multipleChoice   MultipleChoiceQuestion?
  openEnded        OpenEndedQuestion?
  listQuestion     ListQuestion?
  groupingQuestion GroupingQuestion?
  thisOrThat       ThisOrThatQuestion?
  rankingQuestion  RankingQuestion?
  mediaQuestion    MediaQuestion?
  promptQuestion   PromptQuestion?
}

model MultipleChoiceQuestion {
  id            String   @id @default(cuid())
  questionId    String   @unique
  question      Question @relation(fields: [questionId], references: [id])
  options       Json
  correctAnswer String
  createdAt     DateTime @default(now())
}

model OpenEndedQuestion {
  id              String   @id @default(cuid())
  questionId      String   @unique
  question        Question @relation(fields: [questionId], references: [id])
  answer          String
  acceptedAnswers Json
  createdAt       DateTime @default(now())
}

model ListQuestion {
  id          String   @id @default(cuid())
  questionId  String   @unique
  question    Question @relation(fields: [questionId], references: [id])
  answers     Json
  minRequired Int
  createdAt   DateTime @default(now())
}

model GroupingQuestion {
  id           String   @id @default(cuid())
  questionId   String   @unique
  question     Question @relation(fields: [questionId], references: [id])
  groupName    String
  items        Json
  correctItems Json
  createdAt    DateTime @default(now())
}

model ThisOrThatQuestion {
  id         String   @id @default(cuid())
  questionId String   @unique
  question   Question @relation(fields: [questionId], references: [id])
  categoryA  String
  categoryB  String
  categoryC  String?
  items      Json
  createdAt  DateTime @default(now())
}

model RankingQuestion {
  id         String   @id @default(cuid())
  questionId String   @unique
  question   Question @relation(fields: [questionId], references: [id])
  items      Json
  criteria   String
  createdAt  DateTime @default(now())
}

model MediaQuestion {
  id              String   @id @default(cuid())
  questionId      String   @unique
  question        Question @relation(fields: [questionId], references: [id])
  mediaType       String
  mediaUrl        String
  answer          String
  acceptedAnswers Json
  createdAt       DateTime @default(now())
}

model PromptQuestion {
  id              String   @id @default(cuid())
  questionId      String   @unique
  question        Question @relation(fields: [questionId], references: [id])
  prompt          String
  answer          String
  acceptedAnswers Json
  hints           Json
  createdAt       DateTime @default(now())
}

model Game {
  id              String   @id @default(cuid())
  mode            String
  status          String   @default("waiting")
  players         Json
  score           Json
  currentQuestion String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model User {
  id           String             @id @default(cuid())
  email        String             @unique
  username     String             @unique
  passwordHash String
  passwordSalt String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  sessions     UserSession[]
  stats        UserStats?
  clueProgress UserClueProgress[]
}

model UserSession {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tokenHash String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([expiresAt])
}

model UserStats {
  id               String   @id @default(cuid())
  userId           String   @unique
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  gamesPlayed      Int      @default(0)
  totalEndMoney    Int      @default(0)
  averageEndMoney  Int      @default(0)
  episodesCompleted Int     @default(0)
  correctAnswers   Int      @default(0)
  incorrectAnswers Int      @default(0)
  skippedQuestions Int      @default(0)
  completedEpisodes Json    @default("[]")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model UserClueProgress {
  id              String   @id @default(cuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  clueId          String
  question        String
  answer          String
  value           Int?
  dailyDouble     Boolean  @default(false)
  tripleStumper   Boolean  @default(false)
  isFinalJeopardy Boolean  @default(false)
  category        String
  round           String
  correctCount    Int      @default(0)
  incorrectCount  Int      @default(0)
  skipCount       Int      @default(0)
  lastOutcome     String   @default("skip")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([userId, clueId])
  @@index([userId, updatedAt])
}
